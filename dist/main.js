#!/usr/bin/env node
(function () {var p={};Object.defineProperty(p,"__esModule",{value:!0});const C=require("child_process");var d=({command:r,args:e,cwd:s}={command:"npx",args:[]},o=!0)=>new Promise(($,p)=>{const c=C.spawn(r,e,{cwd:s});o&&c.stderr.pipe(process.stderr),o&&c.stdout.pipe(process.stdout),c.on("close",r=>0!==r?p(!!r):$(!!r))});p.Worker=d;var n={};Object.defineProperty(n,"__esModule",{value:!0});var f=e=>process.argv.toString().includes(e);n.includes=f;var q=(e,r=!0,t=e=>e)=>{if(process.argv.toString().includes(e)){const s=process.argv[process.argv.indexOf(e)+1];return s?s.includes("--")?r:t(s):r}return r};n.nextOrDefault=q;var e={},D=e&&e.__awaiter||function(r,e,$,t){return new($||($=Promise))(function(n,a){function o(r){try{J(t.next(r))}catch(e){a(e)}}function i(r){try{J(t.throw(r))}catch(e){a(e)}}function J(r){var e;r.done?n(r.value):(e=r.value,e instanceof $?e:new $(function(r){r(e)})).then(o,i)}J((t=t.apply(r,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const E=require("util"),F=require("fs"),G=require("path");function H(r){return D(this,void 0,void 0,function*(){return JSON.parse((yield E.promisify(F.readFile)(G.join(process.cwd(),r),{encoding:"utf-8"})))})}var o=H;e.readJson=o;var r={};Object.defineProperty(r,"__esModule",{value:!0});const I=require("fs"),J=require("path");function K(e,$){I.writeFileSync(J.join(process.cwd(),e),JSON.stringify($,null,2),{encoding:"utf-8"})}var g=K;r.writeFileJson=g;var h={},L=h&&h.__awaiter||function(e,n,r,$){return new(r||(r=Promise))(function(t,o){function a(e){try{w($.next(e))}catch(n){o(n)}}function i(e){try{w($.throw(e))}catch(n){o(n)}}function w(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r(function(e){e(n)})).then(a,i)}w(($=$.apply(e,n||[])).next())})};Object.defineProperty(h,"__esModule",{value:!0});const M=require("util"),N=require("fs");function O(){return L(this,void 0,void 0,function*(){g("package.json",(yield o("package.temp.json"))),yield M.promisify(N.unlink)("package.temp.json")})}var s=O;h.revertJson=s;var t={};Object.defineProperty(t,"__esModule",{value:!0});var b=".packages";t.linkedPackagesName=b;var i={},u=i&&i.__awaiter||function(e,i,n,$){return new(n||(n=Promise))(function(o,t){function r(e){try{p($.next(e))}catch(i){t(i)}}function a(e){try{p($.throw(e))}catch(i){t(i)}}function p(e){var i;e.done?o(e.value):(i=e.value,i instanceof n?i:new n(function(e){e(i)})).then(r,a)}p(($=$.apply(e,i||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0});const P=require("util"),Q=require("fs");function R(e,i){return u(this,void 0,void 0,function*(){yield Promise.all(i.map(({dep:i})=>u(this,void 0,void 0,function*(){console.log(`file:./${b}/${i.split("/")[1]}`),console.log("dep",JSON.stringify(i,null,4)),e.dependencies[i]=`file:./${b}/${i.split("/")[1]}`}))),yield P.promisify(Q.writeFile)("./package.json",JSON.stringify(e,null,2),{encoding:"utf-8"})})}var v=R;i.modifyJson=v;var j={},S=j&&j.__awaiter||function(e,a,r,n){return new(r||(r=Promise))(function($,t){function i(e){try{o(n.next(e))}catch(a){t(a)}}function l(e){try{o(n.throw(e))}catch(a){t(a)}}function o(e){var a;e.done?$(e.value):(a=e.value,a instanceof r?a:new r(function(e){e(a)})).then(i,l)}o((n=n.apply(e,a||[])).next())})};Object.defineProperty(j,"__esModule",{value:!0});const T=require("util"),U=require("fs");function V(e){return S(this,void 0,void 0,function*(){f("--leave-changes")?(yield T.promisify(U.exists)("package.temp.json"))||g("package.temp.json",e):g("package.json",e),process.exit()})}var a=V;j.exitHandler=a;var k={},w=k&&k.__awaiter||function(r,e,$,a){return new($||($=Promise))(function(c,s){function t(r){try{i(a.next(r))}catch(e){s(e)}}function u(r){try{i(a.throw(r))}catch(e){s(e)}}function i(r){var e;r.done?c(r.value):(e=r.value,e instanceof $?e:new $(function(r){r(e)})).then(t,u)}i((a=a.apply(r,e||[])).next())})};Object.defineProperty(k,"__esModule",{value:!0});const W=require("util"),x=require("path"),X=require("fs");function Y(){return w(this,void 0,void 0,function*(){return yield Promise.all((yield W.promisify(X.readdir)(x.join(process.cwd(),b))).map(r=>w(this,void 0,void 0,function*(){yield d({command:"npx",args:q("--buildCommand","tsc").split(" "),cwd:x.join(process.cwd(),b,r)},!1)})))})}var y=Y;k.buildPackages=y;var l={},z=l&&l.__awaiter||function(e,r,o,$){return new(o||(o=Promise))(function(a,n){function t(e){try{Q($.next(e))}catch(r){n(r)}}function c(e){try{Q($.throw(e))}catch(r){n(r)}}function Q(e){var r;e.done?a(e.value):(r=e.value,r instanceof o?r:new o(function(e){e(r)})).then(t,c)}Q(($=$.apply(e,r||[])).next())})};Object.defineProperty(l,"__esModule",{value:!0});function Z(e){return z(this,void 0,void 0,function*(){yield Promise.all(e.map(({folder:e})=>z(this,void 0,void 0,function*(){const r=["-r","--exclude","node_modules","--exclude","dist","--exclude",".cache",e,`./${b}`];yield d({command:"rsync",args:r})})))})}var A=Z;l.copyPackages=A;var m={},$=m&&m.__awaiter||function(e,r,i,a){return new(i||(i=Promise))(function($,n){function t(e){try{s(a.next(e))}catch(r){n(r)}}function o(e){try{s(a.throw(e))}catch(r){n(r)}}function s(e){var r;e.done?$(e.value):(r=e.value,r instanceof i?r:new i(function(e){e(r)})).then(t,o)}s((a=a.apply(e,r||[])).next())})};Object.defineProperty(m,"__esModule",{value:!0});function _(){return $(this,void 0,void 0,function*(){const e=yield o("package.json");e.fireConfig=e.fireConfig||{};let r=e.fireConfig.runner||"firebase";const i=JSON.parse(JSON.stringify(e));if(f("--revert-changes"))return yield s();if(e&&e.fireDependencies){const r=e.fireDependencies,$=Object.keys(r).map(e=>({dep:e,folder:r[e]}));if(yield A($),f("--buildCommand"))try{yield y()}catch(a){}process.stdin.resume(),process.on("exit",()=>a(i)),process.on("SIGINT",()=>a(i)),process.on("SIGUSR1",()=>a(i)),process.on("SIGUSR2",()=>a(i)),process.on("uncaughtException",()=>a(i)),yield v(e,$)}yield d({command:"npx",args:[r,...process.argv.slice(2).filter(e=>"--leave-changes"!==e&&"--revert-changes"!==e&&"--buildCommand"!==e)]}),a(i)})}var B=_;m.createVirtualSymlink=B;var c={},aa=c&&c.__awaiter||function(e,a,n,r){return new(n||(n=Promise))(function(c,t){function i(e){try{f(r.next(e))}catch(a){t(a)}}function $(e){try{f(r.throw(e))}catch(a){t(a)}}function f(e){var a;e.done?c(e.value):(a=e.value,a instanceof n?a:new n(function(e){e(a)})).then(i,$)}f((r=r.apply(e,a||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0});function ba(){return aa(this,void 0,void 0,function*(){try{yield B()}catch(e){console.log(e)}})}ba();if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=c}else if(typeof define==="function"&&define.amd){define(function(){return c})}})();